
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>vts_solver_demo</title><meta name="generator" content="MATLAB 7.13"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2012-12-17"><meta name="DC.source" content="vts_solver_demo.m"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">Solver Demos</a></li><li><a href="#2">Example ROfRhoAndFt</a></li><li><a href="#3">Example ROfFxAndFt</a></li><li><a href="#4">Example FluenceOfRhoAndZ</a></li><li><a href="#5">Example FluenceOfRhoAndZ</a></li><li><a href="#6">Example PHDOfRhoAndZ</a></li><li><a href="#7">Example AbsorbedEnergyOfRhoAndZ</a></li><li><a href="#8">Example ROfRho</a></li><li><a href="#9">Example ROfRhoAndT</a></li><li><a href="#10">Example ROfFxAndT</a></li><li><a href="#11">Example ROfFx (single set of optical properties)</a></li><li><a href="#12">Example ROfFx (multiple sets of optical properties)</a></li><li><a href="#13">Example ROfFx (multiple optical properties, varying mua as a function of wavelength)</a></li><li><a href="#14">Example ROfFx</a></li></ul></div><h2>Solver Demos<a name="1"></a></h2><p>Script for demoing use of the VTS solvers within Matlab</p><pre class="codeinput">clear <span class="string">all</span>
clc
dbstop <span class="string">if</span> <span class="string">error</span>;

startup();
</pre><h2>Example ROfRhoAndFt<a name="2"></a></h2><p>Evaluate ROfRhoAndFt with one set of optical properites</p><pre class="codeinput">op = [0.01 1.2 0.8 1.4];
rho = 10; <span class="comment">% s-d separation, in mm</span>
ft = 0:0.01:0.5; <span class="comment">% range of temporal frequencies in GHz</span>

VtsSolvers.SetSolverType(<span class="string">'PointSourceSDA'</span>);

test = VtsSolvers.ROfRhoAndFt(op, rho, ft);

f = figure;
subplot(3,1,1); plot(ft, [real(test) -imag(test)] );
title(<span class="string">'Reflectance vs f_t'</span>);
ylabel(<span class="string">'R(f_t)'</span>);
xlabel(<span class="string">'f_t'</span>);
lgnd = legend(<span class="string">'Real'</span>,<span class="string">'Imaginary'</span>);
set(lgnd, <span class="string">'FontSize'</span>, 12);
subplot(3,1,2); plot(ft, abs(test));
title(<span class="string">'Reflectance amplitude vs f_t'</span>);
ylabel(<span class="string">'R(f_t) Amplitude'</span>);
xlabel(<span class="string">'f_t'</span>);
subplot(3,1,3); plot(ft, -angle(test));<span class="comment">% or 'plot(ft, atan2(imag(test),real(test)))'</span>
title(<span class="string">'Reflectance phase vs f_t'</span>);
ylabel(<span class="string">'R(f_t) Phase'</span>);
xlabel(<span class="string">'f_t'</span>);
set(f,<span class="string">'Name'</span>,<span class="string">'Frequency-domain reflectance'</span>);
</pre><img vspace="5" hspace="5" src="vts_solver_demo_01.png" alt=""> <h2>Example ROfFxAndFt<a name="3"></a></h2><p>Evaluate ROfFxAndFt with one set of optical properites</p><pre class="codeinput">op = [0.01 1 0.8 1.4];
fx = 0; <span class="comment">% spatial frequency in 1/mm</span>
ft = linspace(0,0.5,51); <span class="comment">% temporal frequency in GHz</span>

test = VtsSolvers.ROfFxAndFt(op, fx, ft);

f = figure;
subplot(3,1,1); plot(ft, [real(test) -imag(test)] );
title(<span class="string">'Reflectance vs f_t'</span>);
ylabel(<span class="string">'R(f_t)'</span>);
xlabel(<span class="string">'f_t'</span>);
legend(<span class="string">'Real'</span>,<span class="string">'Imaginary'</span>);
subplot(3,1,2); plot(ft, abs(test));
title(<span class="string">'Reflectance amplitude vs f_t'</span>);
ylabel(<span class="string">'R(f_t) Amplitude'</span>);
xlabel(<span class="string">'f_t'</span>);
subplot(3,1,3); plot(ft, -angle(test));<span class="comment">% or 'plot(ft, atan2(imag(test),real(test)))'</span>
title(<span class="string">'Reflectance phase vs f_t'</span>);
ylabel(<span class="string">'R(f_t) Phase'</span>);
xlabel(<span class="string">'f_t'</span>);
set(f,<span class="string">'Name'</span>,<span class="string">'ROfFxAndFt'</span>);
</pre><img vspace="5" hspace="5" src="vts_solver_demo_02.png" alt=""> <h2>Example FluenceOfRhoAndZ<a name="4"></a></h2><p>Evaluate FluenceOfRhoAndZ</p><pre class="codeinput">rhos = 0.1:0.1:10; <span class="comment">% s-d separation, in mm</span>
zs = 0.1:0.1:10; <span class="comment">% z range in mm</span>

wv = 450:0.5:1000;

<span class="comment">% create a list of chromophore absorbers and their concentrations</span>
absorbers.Names =           {<span class="string">'HbO2'</span>, <span class="string">'Hb'</span>, <span class="string">'H2O'</span>};
absorbers.Concentrations =  [70,     30,   0.8  ];

<span class="comment">% create a scatterer (PowerLaw, Intralipid, or Mie)</span>
scatterer.Type = <span class="string">'PowerLaw'</span>;
scatterer.A = 1.2;
scatterer.b = 1.42;

<span class="comment">% % or</span>
<span class="comment">% scatterer.Type = 'Intralipid';</span>
<span class="comment">% scatterer.vol_frac =  0.5;</span>

<span class="comment">% % or</span>
<span class="comment">% scatterer.Type = 'Mie';</span>
<span class="comment">% scatterer.radius =  0.5;</span>
<span class="comment">% scatterer.n =       1.4;</span>
<span class="comment">% scatterer.nMedium = 1.0;</span>

op = VtsSpectroscopy.GetOP(absorbers, scatterer, wv);

test = VtsSolvers.FluenceOfRhoAndZ(op, rhos, zs);

f = figure; imagesc(log(squeeze(test(:,1,:))));
set(f,<span class="string">'Name'</span>,<span class="string">'Fluence of Rho and z'</span>);
</pre><img vspace="5" hspace="5" src="vts_solver_demo_03.png" alt=""> <h2>Example FluenceOfRhoAndZ<a name="5"></a></h2><p>Evaluate FluenceOfRhoAndZ</p><pre class="codeinput">op = [0.01 1 0.8 1.4];
rhos = linspace(0.1,19.9,100); <span class="comment">% s-d separation, in mm</span>
zs = linspace(0.1,19.9,100); <span class="comment">% z range in mm</span>

VtsSolvers.SetSolverType(<span class="string">'DistributedGaussianSourceSDA'</span>);
test = VtsSolvers.FluenceOfRhoAndZ(op, rhos, zs);

xs = [-fliplr(rhos(2:end)),rhos];
<span class="comment">% xs = [-rhos(end:-1:2), rhos];</span>

<span class="comment">% f = figure; imagesc(log(test));</span>
f = figure; imagesc(xs,zs,<span class="keyword">...</span>
    log([fliplr(test(:,2:end)),test]));
axis <span class="string">image</span>
title(<span class="string">'Fluence of \rho and z'</span>);
xlabel(<span class="string">'\rho [mm]'</span>)
ylabel(<span class="string">'z [mm]'</span>)
set(f,<span class="string">'Name'</span>,<span class="string">'Fluence of Rho and z'</span>);
</pre><img vspace="5" hspace="5" src="vts_solver_demo_04.png" alt=""> <h2>Example PHDOfRhoAndZ<a name="6"></a></h2><p>Evaluate PHDOfRhoAndZ</p><pre class="codeinput">op = [0.01 1 0.8 1.4];
rhos = linspace(0.1,19.9,100); <span class="comment">% s-d separation, in mm</span>
zs = linspace(0.1,19.9,100); <span class="comment">% z range in mm</span>

VtsSolvers.SetSolverType(<span class="string">'DistributedGaussianSourceSDA'</span>);
test = VtsSolvers.PHDOfRhoAndZ(op, rhos, zs, 10);

f = figure; imagesc(rhos, zs, log(test));
axis <span class="string">image</span>;
title(<span class="string">'Photon Hitting Density of \rho and z'</span>);
xlabel(<span class="string">'\rho [mm]'</span>)
ylabel(<span class="string">'z [mm]'</span>)
set(f,<span class="string">'Name'</span>,<span class="string">'PHD of Rho and z'</span>);
</pre><img vspace="5" hspace="5" src="vts_solver_demo_05.png" alt=""> <h2>Example AbsorbedEnergyOfRhoAndZ<a name="7"></a></h2><p>Evaluate AbsorbedEnergyOfRhoAndZ</p><pre class="codeinput">op = [0.1 1 0.8 1.4];
rhos = linspace(0.1,19.9,100); <span class="comment">% s-d separation, in mm</span>
zs = linspace(0.1,19.9,100); <span class="comment">% z range in mm</span>

VtsSolvers.SetSolverType(<span class="string">'PointSourceSDA'</span>);

xs = [-fliplr(rhos(2:end)),rhos];

test = VtsSolvers.AbsorbedEnergyOfRhoAndZ(op, rhos, zs);
<span class="comment">% f = figure; imagesc(log(test));</span>
f = figure; imagesc(xs, zs, log([fliplr(test),test]));
axis <span class="string">image</span>;
title(<span class="string">'Absorbed Energy of \rho and z'</span>);
xlabel(<span class="string">'\rho [mm]'</span>)
ylabel(<span class="string">'z [mm]'</span>)
set(f,<span class="string">'Name'</span>,<span class="string">'Absorbed Energy of Rho and z'</span>);
</pre><img vspace="5" hspace="5" src="vts_solver_demo_06.png" alt=""> <h2>Example ROfRho<a name="8"></a></h2><p>Evaluate ROfRho with two sets of optical properites</p><pre class="codeinput">op = [[0.01 1 0.8 1.4]; [0.1 1 0.8 1.4]; [1 1 0.8 1.4]];
rho = 0.5:0.05:9.5; <span class="comment">%s-d separation, in mm</span>
<span class="comment">%VtsSolvers.SolverType = 'DistributedPointSourceSDA';</span>
test = VtsSolvers.ROfRho(op, rho);
f = figure; plot(rho, test);
set(f,<span class="string">'Name'</span>,<span class="string">'R of Rho'</span>);
<span class="comment">% create the legend with just the mua value from the optical properties</span>
options = [{<span class="string">'FontSize'</span>, 12}; {<span class="string">'Location'</span>, <span class="string">'NorthEast'</span>}];
PlotHelper.CreateLegend(op(:,1), <span class="string">'\mu_a: '</span>, <span class="string">'mm^-^1'</span>, options);
title(<span class="string">'Reflectance vs \rho for various optical properties'</span>);
ylabel(<span class="string">'R(\rho)'</span>);
xlabel(<span class="string">'\rho'</span>);
</pre><img vspace="5" hspace="5" src="vts_solver_demo_07.png" alt=""> <h2>Example ROfRhoAndT<a name="9"></a></h2><p>Evaluate ROfRhoAndT at one s-d separation and two sets of optical properites</p><pre class="codeinput">op = [[0.1 1.2 0.8 1.4]; [0.2 1.2 0.8 1.4]];
rho = 10; <span class="comment">%s-d separation, in mm</span>
t = 0:0.001:0.5; <span class="comment">% range of times in ns</span>
test0 = VtsSolvers.ROfRhoAndT(op, rho, t);
f = figure; plot(t,squeeze(test0));
set(f,<span class="string">'Name'</span>,<span class="string">'R of Rho and t'</span>);
title(<span class="string">'Reflectance vs time for various optical properties'</span>);
ylabel(<span class="string">'R(t)'</span>);
xlabel(<span class="string">'Time, t [ns]'</span>);
</pre><img vspace="5" hspace="5" src="vts_solver_demo_08.png" alt=""> <h2>Example ROfFxAndT<a name="10"></a></h2><p>Evaluate ROfFxAndT one set of optical properites</p><pre class="codeinput">op = [0.1 1 0.8 1.4];
fx = linspace(0,0.5,11); <span class="comment">% range of spatial frequencies in 1/mm</span>
t = linspace(0,0.05,501); <span class="comment">% range of times in ns</span>
test = VtsSolvers.ROfFxAndT(op, fx, t);
f = figure; plot(t,squeeze(test(:,:,:)));
set(f,<span class="string">'Name'</span>,<span class="string">'R of fx and t (Reflectance vs time)'</span>);
title(<span class="string">'Reflectance vs time at various spatial frequencies'</span>);
ylabel(<span class="string">'R(f_x, t)'</span>);
xlabel(<span class="string">'Time, t [ns]'</span>);
<span class="comment">%Create the legend dynamically</span>
options = [{<span class="string">'FontSize'</span>, 12}; {<span class="string">'Location'</span>, <span class="string">'NorthEast'</span>}];
PlotHelper.CreateLegend(fx, <span class="string">'f_x = '</span>, <span class="string">'mm^-^1'</span>, options);
t = [0.01 0.05];
test = VtsSolvers.ROfFxAndT(op, fx, t);
f = figure; plot(fx,squeeze(test));
set(f,<span class="string">'Name'</span>,<span class="string">'R of fx and t (Reflectance vs spatial frequency)'</span>);
title(<span class="string">'Reflectance vs spatial frequency at 0.01 and 0.05 ns'</span>);
ylabel(<span class="string">'R(f_x, t)'</span>);
xlabel(<span class="string">'Spatial frequency, f_x [mm^-^1]'</span>);
<span class="comment">%Create the legend dynamically - can be replaced by PlotHelper.CreateLegend(t, 't = ', 'ns', '');</span>
l2 = cell(1,length(t)); <span class="comment">%create a 1xlength(t) cell array to hold the string values</span>
<span class="keyword">for</span> i=1:length(t)
    str = sprintf(<span class="string">'t = %2.2fns'</span>, t(i));
    l2{1,i} = str;
<span class="keyword">end</span>
legend(l2, <span class="string">'FontSize'</span>, 12);
</pre><img vspace="5" hspace="5" src="vts_solver_demo_09.png" alt=""> <img vspace="5" hspace="5" src="vts_solver_demo_10.png" alt=""> <h2>Example ROfFx (single set of optical properties)<a name="11"></a></h2><p>Evaluate ROfFx with single set of optical properties</p><pre class="codeinput">fx = 0:0.001:0.2; <span class="comment">% range of spatial frequencies in 1/mm</span>
op = [0.1 1.2 0.8 1.4];
test1 = VtsSolvers.ROfFx(op, fx);
f = figure; plot(fx, test1);
set(f,<span class="string">'Name'</span>,<span class="string">'R of fx'</span>);
title(<span class="string">'Reflectance vs spatial frequency'</span>);
ylabel(<span class="string">'R(f_x)'</span>);
xlabel(<span class="string">'Spatial frequency, f_x [mm^-^1]'</span>);
</pre><img vspace="5" hspace="5" src="vts_solver_demo_11.png" alt=""> <h2>Example ROfFx (multiple sets of optical properties)<a name="12"></a></h2><p>Evaluate ROfFx with multiple sets of optical properties, varying mua linearly</p><pre class="codeinput">fx = 0:0.001:0.2; <span class="comment">% range of spatial frequencies in 1/mm</span>
mua = (0:0.01:0.1)';
op = repmat([0 1.2 0.8 1.4],[length(mua) 1]);
op(:,1) = mua;

test2 = VtsSolvers.ROfFx(op, fx);
f = figure; plot(fx, test2);
set(f, <span class="string">'Name'</span>, <span class="string">'R of fx (varying mua linearly)'</span>);
title(<span class="string">'Reflectance vs spatial frequency'</span>);
ylabel(<span class="string">'R(f_x)'</span>);
xlabel(<span class="string">'Spatial frequency, f_x [mm^-^1]'</span>);
</pre><img vspace="5" hspace="5" src="vts_solver_demo_12.png" alt=""> <h2>Example ROfFx (multiple optical properties, varying mua as a function of wavelength)<a name="13"></a></h2><p>Call ROfFx with multiple sets of optical properties, varying mua as a function of wavelength</p><pre class="codeinput">fx = 0:0.05:0.2; <span class="comment">% range of spatial frequencies in 1/mm</span>
wv = 450:0.5:1000;
nwv = length(wv);

<span class="comment">% create a list of chromophore absorbers and their concentrations</span>
absorbers.Names =           {<span class="string">'HbO2'</span>, <span class="string">'Hb'</span>, <span class="string">'H2O'</span>};
absorbers.Concentrations =  [70,     30,   0.8  ];

<span class="comment">% create a scatterer (PowerLaw, Intralipid, or Mie)</span>
scatterer.Type = <span class="string">'PowerLaw'</span>;
scatterer.A = 1.2;
scatterer.b = 1.42;

<span class="comment">% % or</span>
<span class="comment">% scatterer.Type = 'Intralipid';</span>
<span class="comment">% scatterer.vol_frac =  0.5;</span>

<span class="comment">% % or</span>
<span class="comment">% scatterer.Type = 'Mie';</span>
<span class="comment">% scatterer.radius =  0.5;</span>
<span class="comment">% scatterer.n =       1.4;</span>
<span class="comment">% scatterer.nMedium = 1.0;</span>

op = VtsSpectroscopy.GetOP(absorbers, scatterer, wv);

<span class="comment">% plot the absorption spectrum</span>
f = figure; plot(wv, op(:,1));
set(f, <span class="string">'Name'</span>, <span class="string">'R of fx (plot absorption spectrum)'</span>);
title(<span class="string">'Absorption vs wavelength'</span>);
ylabel(<span class="string">'\mu_a(\lambda)'</span>);
xlabel(<span class="string">'Wavelength, \lambda [nm]'</span>);

<span class="comment">% plot the log of the absorption spectrum</span>
f = figure; semilogy(wv, op(:,1));
set(f, <span class="string">'Name'</span>, <span class="string">'R of fx (plot log of the absorption spectrum)'</span>);
title(<span class="string">'log(Absorption) vs wavelength'</span>);
ylabel(<span class="string">'\mu_a(\lambda)'</span>);
xlabel(<span class="string">'Wavelength, \lambda [nm]'</span>);

<span class="comment">% plot the scattering spectrum</span>
f = figure; plot(wv, op(:,2));
set(f, <span class="string">'Name'</span>, <span class="string">'R of fx (plot scattering spectrum)'</span>);
title(<span class="string">'Reduced scattering vs wavelength'</span>);
ylabel(<span class="string">'\mu_s^''(\lambda)'</span>);
xlabel(<span class="string">'Wavelength, \lambda [nm]'</span>);

<span class="comment">% calculate and plot the resulting reflectance spectrum at each frequency</span>
test3 = VtsSolvers.ROfFx(op, fx);
f = figure; plot(wv, test3);
set(f, <span class="string">'Name'</span>, <span class="string">'R of fx (plot resulting reflectance spectrum at each frequency)'</span>);
title(<span class="string">'SFD Reflectance vs wavelength'</span>);
ylabel(<span class="string">'R(\lambda)'</span>);
xlabel(<span class="string">'Wavelength, \lambda [nm]'</span>);
options = {<span class="string">'FontSize'</span>, 12};
PlotHelper.CreateLegend(fx, <span class="string">'f_x = '</span>, <span class="string">'mm^-^1'</span>, options);
</pre><img vspace="5" hspace="5" src="vts_solver_demo_13.png" alt=""> <img vspace="5" hspace="5" src="vts_solver_demo_14.png" alt=""> <img vspace="5" hspace="5" src="vts_solver_demo_15.png" alt=""> <img vspace="5" hspace="5" src="vts_solver_demo_16.png" alt=""> <h2>Example ROfFx<a name="14"></a></h2><p>Call planar reflectance with multiple sets of optical properties, varying the scattering prefactor as a function of wavelength</p><pre class="codeinput">fx = 0; <span class="comment">% spatial frequency in 1/mm</span>
wv = 450:0.5:1000;

<span class="comment">% create a list of chromophore absorbers and their concentrations</span>
absorbers.Names =           {<span class="string">'HbO2'</span>, <span class="string">'Hb'</span>, <span class="string">'H2O'</span>};
absorbers.Concentrations =  [70,     30,   0.8  ];

<span class="comment">% create a scatterer (PowerLaw, Intralipid, or Mie)</span>
scatterer.Type = <span class="string">'PowerLaw'</span>;
scatterer.A = 1.0;
scatterer.b = 1.42;

A = 0.5:0.25:2.5;
test4 = zeros([length(A) length(wv)]);
<span class="keyword">for</span> i=1:length(A)
    scatterer.A = A(i);
    op = VtsSpectroscopy.GetOP(absorbers, scatterer, wv);
    test4(i,:) = VtsSolvers.ROfFx(op, fx);
<span class="keyword">end</span>

f = figure; plot(wv, test4');
set(f, <span class="string">'Name'</span>, <span class="string">'Planar reflectance'</span>);
title(<span class="string">'SFD Reflectance vs wavelength'</span>);
ylabel(<span class="string">'R(\lambda)'</span>);
xlabel(<span class="string">'Wavelength, \lambda [nm]'</span>);
options = [{<span class="string">'Location'</span>, <span class="string">'NorthWest'</span>}; {<span class="string">'FontSize'</span>, 12}; {<span class="string">'Box'</span>, <span class="string">'on'</span>}];
PlotHelper.CreateLegend(A, <span class="string">'\mu_s''(1000nm) = '</span>, <span class="string">'mm^-^1'</span>, options);
</pre><img vspace="5" hspace="5" src="vts_solver_demo_17.png" alt=""> <p class="footer"><br>
      Published with MATLAB&reg; 7.13<br></p></div><!--
##### SOURCE BEGIN #####
%% Solver Demos
% Script for demoing use of the VTS solvers within Matlab
clear all
clc
dbstop if error;

startup();

%% Example ROfRhoAndFt
% Evaluate ROfRhoAndFt with one set of optical properites

op = [0.01 1.2 0.8 1.4];
rho = 10; % s-d separation, in mm
ft = 0:0.01:0.5; % range of temporal frequencies in GHz

VtsSolvers.SetSolverType('PointSourceSDA');

test = VtsSolvers.ROfRhoAndFt(op, rho, ft);

f = figure;
subplot(3,1,1); plot(ft, [real(test) -imag(test)] );
title('Reflectance vs f_t'); 
ylabel('R(f_t)');
xlabel('f_t');
lgnd = legend('Real','Imaginary');
set(lgnd, 'FontSize', 12);
subplot(3,1,2); plot(ft, abs(test));
title('Reflectance amplitude vs f_t'); 
ylabel('R(f_t) Amplitude');
xlabel('f_t');
subplot(3,1,3); plot(ft, -angle(test));% or 'plot(ft, atan2(imag(test),real(test)))'
title('Reflectance phase vs f_t'); 
ylabel('R(f_t) Phase');
xlabel('f_t');
set(f,'Name','Frequency-domain reflectance');

%% Example ROfFxAndFt
% Evaluate ROfFxAndFt with one set of optical properites

op = [0.01 1 0.8 1.4];
fx = 0; % spatial frequency in 1/mm
ft = linspace(0,0.5,51); % temporal frequency in GHz

test = VtsSolvers.ROfFxAndFt(op, fx, ft);

f = figure;
subplot(3,1,1); plot(ft, [real(test) -imag(test)] );
title('Reflectance vs f_t'); 
ylabel('R(f_t)');
xlabel('f_t');
legend('Real','Imaginary');
subplot(3,1,2); plot(ft, abs(test));
title('Reflectance amplitude vs f_t'); 
ylabel('R(f_t) Amplitude');
xlabel('f_t');
subplot(3,1,3); plot(ft, -angle(test));% or 'plot(ft, atan2(imag(test),real(test)))'
title('Reflectance phase vs f_t'); 
ylabel('R(f_t) Phase');
xlabel('f_t');
set(f,'Name','ROfFxAndFt');

%% Example FluenceOfRhoAndZ
% Evaluate FluenceOfRhoAndZ

rhos = 0.1:0.1:10; % s-d separation, in mm
zs = 0.1:0.1:10; % z range in mm

wv = 450:0.5:1000;

% create a list of chromophore absorbers and their concentrations
absorbers.Names =           {'HbO2', 'Hb', 'H2O'};
absorbers.Concentrations =  [70,     30,   0.8  ];

% create a scatterer (PowerLaw, Intralipid, or Mie)
scatterer.Type = 'PowerLaw';
scatterer.A = 1.2;
scatterer.b = 1.42;

% % or 
% scatterer.Type = 'Intralipid';
% scatterer.vol_frac =  0.5;

% % or 
% scatterer.Type = 'Mie';
% scatterer.radius =  0.5;
% scatterer.n =       1.4;
% scatterer.nMedium = 1.0;

op = VtsSpectroscopy.GetOP(absorbers, scatterer, wv);

test = VtsSolvers.FluenceOfRhoAndZ(op, rhos, zs);

f = figure; imagesc(log(squeeze(test(:,1,:))));
set(f,'Name','Fluence of Rho and z');

%% Example FluenceOfRhoAndZ
% Evaluate FluenceOfRhoAndZ

op = [0.01 1 0.8 1.4];
rhos = linspace(0.1,19.9,100); % s-d separation, in mm
zs = linspace(0.1,19.9,100); % z range in mm

VtsSolvers.SetSolverType('DistributedGaussianSourceSDA');
test = VtsSolvers.FluenceOfRhoAndZ(op, rhos, zs);

xs = [-fliplr(rhos(2:end)),rhos];
% xs = [-rhos(end:-1:2), rhos];

% f = figure; imagesc(log(test));
f = figure; imagesc(xs,zs,...
    log([fliplr(test(:,2:end)),test]));
axis image
title('Fluence of \rho and z'); 
xlabel('\rho [mm]')
ylabel('z [mm]')
set(f,'Name','Fluence of Rho and z');

%% Example PHDOfRhoAndZ
% Evaluate PHDOfRhoAndZ

op = [0.01 1 0.8 1.4];
rhos = linspace(0.1,19.9,100); % s-d separation, in mm
zs = linspace(0.1,19.9,100); % z range in mm

VtsSolvers.SetSolverType('DistributedGaussianSourceSDA');
test = VtsSolvers.PHDOfRhoAndZ(op, rhos, zs, 10);

f = figure; imagesc(rhos, zs, log(test));
axis image;
title('Photon Hitting Density of \rho and z'); 
xlabel('\rho [mm]')
ylabel('z [mm]')
set(f,'Name','PHD of Rho and z');

%% Example AbsorbedEnergyOfRhoAndZ
% Evaluate AbsorbedEnergyOfRhoAndZ

op = [0.1 1 0.8 1.4];
rhos = linspace(0.1,19.9,100); % s-d separation, in mm
zs = linspace(0.1,19.9,100); % z range in mm

VtsSolvers.SetSolverType('PointSourceSDA');

xs = [-fliplr(rhos(2:end)),rhos];

test = VtsSolvers.AbsorbedEnergyOfRhoAndZ(op, rhos, zs);
% f = figure; imagesc(log(test));
f = figure; imagesc(xs, zs, log([fliplr(test),test]));
axis image;
title('Absorbed Energy of \rho and z'); 
xlabel('\rho [mm]')
ylabel('z [mm]')
set(f,'Name','Absorbed Energy of Rho and z');

%% Example ROfRho
% Evaluate ROfRho with two sets of optical properites

op = [[0.01 1 0.8 1.4]; [0.1 1 0.8 1.4]; [1 1 0.8 1.4]];
rho = 0.5:0.05:9.5; %s-d separation, in mm
%VtsSolvers.SolverType = 'DistributedPointSourceSDA';
test = VtsSolvers.ROfRho(op, rho);
f = figure; plot(rho, test);
set(f,'Name','R of Rho');
% create the legend with just the mua value from the optical properties
options = [{'FontSize', 12}; {'Location', 'NorthEast'}];
PlotHelper.CreateLegend(op(:,1), '\mu_a: ', 'mm^-^1', options);
title('Reflectance vs \rho for various optical properties'); 
ylabel('R(\rho)');
xlabel('\rho');

%% Example ROfRhoAndT
% Evaluate ROfRhoAndT at one s-d separation and two sets of optical properites

op = [[0.1 1.2 0.8 1.4]; [0.2 1.2 0.8 1.4]];
rho = 10; %s-d separation, in mm
t = 0:0.001:0.5; % range of times in ns
test0 = VtsSolvers.ROfRhoAndT(op, rho, t);
f = figure; plot(t,squeeze(test0));
set(f,'Name','R of Rho and t');
title('Reflectance vs time for various optical properties'); 
ylabel('R(t)');
xlabel('Time, t [ns]');

%% Example ROfFxAndT 
% Evaluate ROfFxAndT one set of optical properites

op = [0.1 1 0.8 1.4];
fx = linspace(0,0.5,11); % range of spatial frequencies in 1/mm
t = linspace(0,0.05,501); % range of times in ns
test = VtsSolvers.ROfFxAndT(op, fx, t);
f = figure; plot(t,squeeze(test(:,:,:)));
set(f,'Name','R of fx and t (Reflectance vs time)');
title('Reflectance vs time at various spatial frequencies'); 
ylabel('R(f_x, t)');
xlabel('Time, t [ns]');
%Create the legend dynamically
options = [{'FontSize', 12}; {'Location', 'NorthEast'}];
PlotHelper.CreateLegend(fx, 'f_x = ', 'mm^-^1', options);
t = [0.01 0.05];
test = VtsSolvers.ROfFxAndT(op, fx, t);
f = figure; plot(fx,squeeze(test));
set(f,'Name','R of fx and t (Reflectance vs spatial frequency)');
title('Reflectance vs spatial frequency at 0.01 and 0.05 ns'); 
ylabel('R(f_x, t)');
xlabel('Spatial frequency, f_x [mm^-^1]');
%Create the legend dynamically - can be replaced by PlotHelper.CreateLegend(t, 't = ', 'ns', '');
l2 = cell(1,length(t)); %create a 1xlength(t) cell array to hold the string values
for i=1:length(t)
    str = sprintf('t = %2.2fns', t(i));
    l2{1,i} = str;
end
legend(l2, 'FontSize', 12);

%% Example ROfFx (single set of optical properties)
% Evaluate ROfFx with single set of optical properties

fx = 0:0.001:0.2; % range of spatial frequencies in 1/mm
op = [0.1 1.2 0.8 1.4];
test1 = VtsSolvers.ROfFx(op, fx);
f = figure; plot(fx, test1);
set(f,'Name','R of fx');
title('Reflectance vs spatial frequency'); 
ylabel('R(f_x)');
xlabel('Spatial frequency, f_x [mm^-^1]');

%% Example ROfFx (multiple sets of optical properties)
% Evaluate ROfFx with multiple sets of optical properties, varying mua linearly 

fx = 0:0.001:0.2; % range of spatial frequencies in 1/mm
mua = (0:0.01:0.1)';
op = repmat([0 1.2 0.8 1.4],[length(mua) 1]);
op(:,1) = mua;

test2 = VtsSolvers.ROfFx(op, fx);
f = figure; plot(fx, test2);
set(f, 'Name', 'R of fx (varying mua linearly)');
title('Reflectance vs spatial frequency'); 
ylabel('R(f_x)');
xlabel('Spatial frequency, f_x [mm^-^1]');

%% Example ROfFx (multiple optical properties, varying mua as a function of wavelength)
% Call ROfFx with multiple sets of optical properties, varying mua as a function of wavelength

fx = 0:0.05:0.2; % range of spatial frequencies in 1/mm
wv = 450:0.5:1000;
nwv = length(wv);

% create a list of chromophore absorbers and their concentrations
absorbers.Names =           {'HbO2', 'Hb', 'H2O'};
absorbers.Concentrations =  [70,     30,   0.8  ];

% create a scatterer (PowerLaw, Intralipid, or Mie)
scatterer.Type = 'PowerLaw';
scatterer.A = 1.2;
scatterer.b = 1.42;

% % or 
% scatterer.Type = 'Intralipid';
% scatterer.vol_frac =  0.5;

% % or 
% scatterer.Type = 'Mie';
% scatterer.radius =  0.5;
% scatterer.n =       1.4;
% scatterer.nMedium = 1.0;

op = VtsSpectroscopy.GetOP(absorbers, scatterer, wv);

% plot the absorption spectrum
f = figure; plot(wv, op(:,1));
set(f, 'Name', 'R of fx (plot absorption spectrum)');
title('Absorption vs wavelength'); 
ylabel('\mu_a(\lambda)');
xlabel('Wavelength, \lambda [nm]');

% plot the log of the absorption spectrum
f = figure; semilogy(wv, op(:,1));
set(f, 'Name', 'R of fx (plot log of the absorption spectrum)');
title('log(Absorption) vs wavelength'); 
ylabel('\mu_a(\lambda)');
xlabel('Wavelength, \lambda [nm]');

% plot the scattering spectrum
f = figure; plot(wv, op(:,2));
set(f, 'Name', 'R of fx (plot scattering spectrum)');
title('Reduced scattering vs wavelength'); 
ylabel('\mu_s^''(\lambda)');
xlabel('Wavelength, \lambda [nm]');

% calculate and plot the resulting reflectance spectrum at each frequency
test3 = VtsSolvers.ROfFx(op, fx);
f = figure; plot(wv, test3);
set(f, 'Name', 'R of fx (plot resulting reflectance spectrum at each frequency)');
title('SFD Reflectance vs wavelength'); 
ylabel('R(\lambda)');
xlabel('Wavelength, \lambda [nm]');
options = {'FontSize', 12};
PlotHelper.CreateLegend(fx, 'f_x = ', 'mm^-^1', options);

%% Example ROfFx
% Call planar reflectance with multiple sets of optical
% properties, varying the scattering prefactor as a function of wavelength

fx = 0; % spatial frequency in 1/mm
wv = 450:0.5:1000;

% create a list of chromophore absorbers and their concentrations
absorbers.Names =           {'HbO2', 'Hb', 'H2O'};
absorbers.Concentrations =  [70,     30,   0.8  ];

% create a scatterer (PowerLaw, Intralipid, or Mie)
scatterer.Type = 'PowerLaw';
scatterer.A = 1.0;
scatterer.b = 1.42;

A = 0.5:0.25:2.5;
test4 = zeros([length(A) length(wv)]);
for i=1:length(A)
    scatterer.A = A(i);
    op = VtsSpectroscopy.GetOP(absorbers, scatterer, wv);
    test4(i,:) = VtsSolvers.ROfFx(op, fx);
end

f = figure; plot(wv, test4');
set(f, 'Name', 'Planar reflectance');
title('SFD Reflectance vs wavelength'); 
ylabel('R(\lambda)');
xlabel('Wavelength, \lambda [nm]');
options = [{'Location', 'NorthWest'}; {'FontSize', 12}; {'Box', 'on'}];
PlotHelper.CreateLegend(A, '\mu_s''(1000nm) = ', 'mm^-^1', options);

##### SOURCE END #####
--></body></html>